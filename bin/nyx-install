#!/usr/bin/env bash

NYXDIR=$(cd $(dirname $0)/.. && pwd)
VENVDIR="$NYXDIR/venv"

help_msg() {
    cat << EOF
Usage: nyx-install [command]

Available commands:
  update     Update nyx install
  reinstall  Delete nyx install then do a new one
EOF
}


nyx_venv() {
    if [ -d $VENVDIR ]; then
        echo "nyx install already exists, use command update or reinstall to override." >&2
        exit 1
    fi
    python3 -m venv "$VENVDIR"
}

nyx_install() {
    source "$VENVDIR/bin/activate"
    pip3 install -r "$NYXDIR/requirements.txt"
}

nyx_uninstall() {
    rm -rf "$VENVDIR"
}

## Main ##
case $1 in
    update) nyx_install;;
    reinstall) nyx_uninstall && nyx_venv && nyx_install;;
    "") nyx_venv && nyx_install;;
    *) help_msg && exit 1;;
esac
